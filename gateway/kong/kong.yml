_format_version: "3.0"
_comment: "Configuraci칩n simple de Kong como API Gateway y balanceador de carga."

# ------------------------------------------------------------------------------
# SERVICIOS: Define los microservicios backend
# ------------------------------------------------------------------------------
services:
  # --- Servicio ms-tickets ---
  - name: service-tickets
    url: http://host.docker.internal:3000
    protocol: http
    connect_timeout: 5000
    read_timeout: 60000
    write_timeout: 60000
    retries: 3
    
    routes:
      # --- Todas las rutas de ms-tickets ---
      - name: route-tickets-all
        paths:
          - /api/v1
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS

  # --- Servicio ms-usuarios ---
  - name: service-users
    url: http://host.docker.internal:3001
    protocol: http
    connect_timeout: 5000
    read_timeout: 30000
    write_timeout: 30000
    retries: 3
    
    routes:
      # --- Todas las rutas de ms-usuarios ---
      - name: route-users-all
        paths:
          - /api/v1/auth
          - /api/v1/users
          - /api/v1/roles
          - /api/v1/permissions
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS

  # --- Servicio ms-eventos ---
  - name: service-events
    url: http://host.docker.internal:3002
    protocol: http
    connect_timeout: 5000
    read_timeout: 30000
    write_timeout: 30000
    retries: 3
    
    routes:
      # --- Todas las rutas de ms-eventos ---
      - name: route-events-all
        paths:
          - /api/v1/events
          - /api/v1/categories
          - /api/v1/venues
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS

  # --- Servicio ms-notifications ---
  - name: service-notifications
    url: http://host.docker.internal:3003
    protocol: http
    connect_timeout: 5000
    read_timeout: 30000
    write_timeout: 30000
    retries: 3
    
    routes:
      # --- Todas las rutas de ms-notifications ---
      - name: route-notifications-all
        paths:
          - /api/v1/notifications
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS

# ------------------------------------------------------------------------------
# PLUGINS GLOBALES: Solo configuraci칩n b치sica de CORS
# ------------------------------------------------------------------------------
plugins:
  # --- CORS b치sico ---
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-Type
        - Date
        - Authorization
        - X-Requested-With
      credentials: true
      max_age: 3600