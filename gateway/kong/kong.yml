_format_version: "3.0"
_comment: "Configuraci칩n de Kong como API Gateway y balanceador de carga con formato /api/v1/ticketslave/"

# ------------------------------------------------------------------------------
# SERVICIOS: Define los microservicios backend
# ------------------------------------------------------------------------------
services:
  # --- Servicio ms-tickets ---
  - name: service-tickets
    url: http://host.docker.internal:3000
    protocol: http
    connect_timeout: 5000
    read_timeout: 60000
    write_timeout: 60000
    retries: 3

    routes:
      - name: tickets-cart
        paths:
          - /api/v1/ticketslave/cart
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
      - name: tickets-orders
        paths:
          - /api/v1/ticketslave/orders
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
      - name: tickets-tickets
        paths:
          - /api/v1/ticketslave/tickets
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
      - name: tickets-ticket-types
        paths:
          - ~/api/v1/ticketslave/events/\d+/ticket-types
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS

  # --- Servicio ms-usuarios ---
  - name: service-users
    url: http://host.docker.internal:3010
    protocol: http
    connect_timeout: 5000
    read_timeout: 30000
    write_timeout: 30000
    retries: 3

    routes:
      - name: usuarios-auth
        paths:
          - /api/v1/ticketslave/auth
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
      - name: usuarios-users
        paths:
          - /api/v1/ticketslave/users
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
      - name: usuarios-roles
        paths:
          - /api/v1/ticketslave/roles
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
      - name: usuarios-permissions
        paths:
          - /api/v1/ticketslave/permissions
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS

  # --- Servicio ms-eventos ---
  - name: service-events
    url: http://host.docker.internal:3005
    protocol: http
    connect_timeout: 5000
    read_timeout: 30000
    write_timeout: 30000
    retries: 3

    routes:
      - name: eventos-events
        paths:
          - /api/v1/ticketslave/events
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
      - name: eventos-categories
        paths:
          - /api/v1/ticketslave/categories
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
      - name: eventos-venues
        paths:
          - /api/v1/ticketslave/venues
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
     

# ------------------------------------------------------------------------------
# PLUGINS GLOBALES: Solo configuraci칩n b치sica de CORS
# ------------------------------------------------------------------------------
plugins:
  # --- CORS b치sico ---
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-Type
        - Date
        - Authorization
        - X-Requested-With
      credentials: true
      max_age: 3600
